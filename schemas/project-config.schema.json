{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "ACIS Project Configuration",
  "description": "Project-specific configuration for ACIS (Automated Code Improvement System)",
  "type": "object",
  "required": ["projectName"],
  "properties": {
    "$schema": {
      "type": "string",
      "description": "JSON Schema reference"
    },
    "projectName": {
      "type": "string",
      "description": "Human-readable name of the project"
    },
    "vision": {
      "type": "object",
      "description": "Project vision captured from /acis init interview or doc extraction",
      "properties": {
        "problem": {
          "type": "string",
          "description": "Problem statement - what problem is being solved (must be descriptive)",
          "minLength": 20
        },
        "solution": {
          "type": "string",
          "description": "Solution overview - how the system solves the problem"
        },
        "scope": {
          "type": "string",
          "description": "Scope boundaries - what's explicitly in/out of scope"
        },
        "successMetrics": {
          "type": "array",
          "items": { "type": "string" },
          "description": "How success will be measured"
        }
      }
    },
    "personas": {
      "type": "array",
      "description": "Target users of the system",
      "items": {
        "type": "object",
        "required": ["name", "role", "type"],
        "properties": {
          "name": {
            "type": "string",
            "description": "Persona name (e.g., 'Brenda') - must be 2+ words or a proper noun",
            "minLength": 2
          },
          "role": {
            "type": "string",
            "description": "Role description (e.g., 'elderly patient') - must be descriptive",
            "minLength": 2
          },
          "type": {
            "type": "string",
            "enum": ["primary", "secondary"],
            "description": "Primary (daily users) or secondary (occasional users)"
          },
          "description": {
            "type": "string",
            "description": "Detailed persona description"
          },
          "keyNeed": {
            "type": "string",
            "description": "Primary need this persona has"
          },
          "frustration": {
            "type": "string",
            "description": "Current frustration with existing solutions"
          },
          "antiPersona": {
            "type": "boolean",
            "default": false,
            "description": "If true, this is someone we're explicitly NOT designing for"
          }
        }
      }
    },
    "compliance": {
      "type": "array",
      "description": "Regulatory/compliance requirements",
      "items": {
        "type": "string",
        "enum": ["HIPAA", "GDPR", "SOC2", "PCI-DSS", "CCPA", "FedRAMP", "ISO27001", "none"]
      }
    },
    "architectureModel": {
      "type": "string",
      "description": "Architecture pattern used in the project",
      "enum": ["three-layer", "hexagonal", "microservices", "monolith", "serverless", "jamstack", "custom"],
      "default": "custom"
    },
    "platform": {
      "type": "object",
      "description": "Target platform capabilities",
      "properties": {
        "web": { "type": "boolean", "default": true },
        "mobile": { "type": "boolean", "default": false },
        "ios": { "type": "boolean", "default": false },
        "android": { "type": "boolean", "default": false },
        "desktop": { "type": "boolean", "default": false },
        "offline": { "type": "boolean", "default": false },
        "voice": { "type": "boolean", "default": false }
      }
    },
    "integrations": {
      "type": "array",
      "description": "External systems to integrate with",
      "items": { "type": "string" }
    },
    "techStack": {
      "type": "object",
      "description": "Technology stack information",
      "properties": {
        "language": { "type": "string" },
        "framework": { "type": "string" },
        "runtime": { "type": "string" },
        "database": { "type": "string" },
        "testFramework": { "type": "string" },
        "packageManager": { "type": "string" }
      }
    },
    "customMetrics": {
      "type": "array",
      "description": "Project-specific metrics for goal verification",
      "items": {
        "type": "object",
        "required": ["id", "name", "command"],
        "properties": {
          "id": {
            "type": "string",
            "description": "Metric identifier (snake_case, minimum 3 chars)",
            "minLength": 3,
            "pattern": "^[a-z][a-z0-9_]*$"
          },
          "name": {
            "type": "string",
            "description": "Human-readable metric name"
          },
          "command": {
            "type": "string",
            "description": "Bash 3.2 compatible detection command"
          },
          "expected_value": {
            "description": "Expected value for this metric"
          },
          "comparison": {
            "type": "string",
            "enum": ["eq", "lt", "lte", "gt", "gte", "contains", "regex"],
            "default": "eq"
          }
        }
      }
    },
    "paths": {
      "type": "object",
      "description": "Artifact paths (all relative to project root, no absolute paths, no '..' traversal)",
      "default": {},
      "properties": {
        "acisRoot": {
          "type": "string",
          "description": "Root directory for all ACIS artifacts",
          "default": "docs/acis",
          "pattern": "^(?!/)(?!.*\\.\\.).*$"
        },
        "goals": {
          "type": "string",
          "description": "Directory for goal JSON files",
          "default": "docs/acis/goals",
          "pattern": "^(?!/)(?!.*\\.\\.).*$"
        },
        "discovery": {
          "type": "string",
          "description": "Directory for discovery reports",
          "default": "docs/acis/discovery",
          "pattern": "^(?!/)(?!.*\\.\\.).*$"
        },
        "decisions": {
          "type": "string",
          "description": "Directory for decision manifests",
          "default": "docs/acis/decisions",
          "pattern": "^(?!/)(?!.*\\.\\.).*$"
        },
        "audits": {
          "type": "string",
          "description": "Directory for Process Auditor reports",
          "default": "docs/acis/audits",
          "pattern": "^(?!/)(?!.*\\.\\.).*$"
        },
        "skills": {
          "type": "string",
          "description": "Directory for project-specific generated skills",
          "default": "docs/acis/skills",
          "pattern": "^(?!/)(?!.*\\.\\.).*$"
        },
        "state": {
          "type": "string",
          "description": "Directory for runtime state files",
          "default": "docs/acis/state",
          "pattern": "^(?!/)(?!.*\\.\\.).*$"
        },
        "progress": {
          "type": "string",
          "description": "Directory for goal progress tracking",
          "default": "docs/acis/state/progress",
          "pattern": "^(?!/)(?!.*\\.\\.).*$"
        },
        "steps": {
          "type": "string",
          "description": "Directory for step manifests (per-goal subdirectories)",
          "default": "docs/acis/state/steps",
          "pattern": "^(?!/)(?!.*\\.\\.).*$"
        },
        "parallel": {
          "type": "string",
          "description": "Directory for parallel batch state files",
          "default": "docs/acis/state/parallel",
          "pattern": "^(?!/)(?!.*\\.\\.).*$"
        },
        "mergeReports": {
          "type": "string",
          "description": "Directory for batch merge reports",
          "default": "docs/acis/merge-reports",
          "pattern": "^(?!/)(?!.*\\.\\.).*$"
        },
        "worktrees": {
          "type": "string",
          "description": "Root directory for git worktrees (git-ignored, ephemeral)",
          "default": ".acis-work",
          "pattern": "^(?!/)(?!.*\\.\\.).*$"
        },
        "knownResolutions": {
          "type": "string",
          "description": "Path to known-resolutions registry file",
          "default": "docs/acis/known-resolutions.json",
          "pattern": "^(?!/)(?!.*\\.\\.).*$"
        },
        "traces": {
          "type": "string",
          "description": "Directory for project-specific execution traces (per-session subdirectories)",
          "default": "docs/acis/traces",
          "pattern": "^(?!/)(?!.*\\.\\.).*$"
        },
        "processTraces": {
          "type": "string",
          "description": "Directory for process-oriented traces (workflow effectiveness, skill patterns)",
          "default": ".acis/traces",
          "pattern": "^(?!/)(?!.*\\.\\.).*$"
        }
      },
      "additionalProperties": false
    },
    "goalsDirectory": {
      "type": "string",
      "description": "DEPRECATED: Use paths.goals instead. Directory for goal JSON files",
      "default": "docs/acis/goals",
      "deprecated": true
    },
    "auditsDirectory": {
      "type": "string",
      "description": "DEPRECATED: Use paths.audits instead. Directory for Process Auditor reports",
      "default": "docs/acis/audits",
      "deprecated": true
    },
    "skillsDirectory": {
      "type": "string",
      "description": "DEPRECATED: Use paths.skills instead. Directory for dynamically generated skills",
      "default": "docs/acis/skills",
      "deprecated": true
    },
    "auditThreshold": {
      "type": "integer",
      "description": "Number of achieved goals before auto-triggering Process Auditor",
      "default": 3,
      "minimum": 1
    },
    "generatedFrom": {
      "type": "string",
      "enum": ["interview", "docs", "manual"],
      "description": "How this config was created"
    },
    "generatedAt": {
      "type": "string",
      "format": "date-time",
      "description": "When this config was generated"
    },
    "lastAudit": {
      "type": "object",
      "description": "State from last Process Auditor run",
      "properties": {
        "timestamp": { "type": "string", "format": "date-time" },
        "goalsAnalyzed": { "type": "integer" },
        "skillsGenerated": { "type": "integer" }
      }
    },
    "goalsSinceAudit": {
      "type": "integer",
      "description": "Goals achieved since last audit",
      "default": 0
    },
    "preCommitReview": {
      "type": "object",
      "description": "Pre-commit review configuration",
      "properties": {
        "defaultMode": {
          "type": "string",
          "enum": ["strict", "advisory"],
          "default": "strict",
          "description": "Default mode for pre-commit review. strict: BLOCK verdict prevents commit (exit 1). advisory: BLOCK is informational only."
        },
        "blockOnSeverity": {
          "type": "string",
          "enum": ["any", "important", "blocking"],
          "default": "any",
          "description": "Minimum severity level that triggers a block in strict mode"
        }
      }
    },
    "pluginDefaults": {
      "type": "object",
      "description": "Default flags based on available plugins",
      "properties": {
        "skipCodex": {
          "type": "boolean",
          "description": "Always use --skip-codex (Codex MCP not available)",
          "default": false
        },
        "skipRalphLoop": {
          "type": "boolean",
          "description": "Skip ralph-loop (ralph-wiggum plugin not available)",
          "default": false
        },
        "useInternalAgentsOnly": {
          "type": "boolean",
          "description": "Use only internal Claude agents for all operations",
          "default": false
        }
      }
    },
    "installedPlugins": {
      "type": "object",
      "description": "Record of plugin availability at init time",
      "properties": {
        "ralphWiggum": {
          "type": "object",
          "properties": {
            "installed": { "type": "boolean" },
            "checkedAt": { "type": "string", "format": "date-time" }
          }
        },
        "codexMcp": {
          "type": "object",
          "properties": {
            "installed": { "type": "boolean" },
            "checkedAt": { "type": "string", "format": "date-time" }
          }
        }
      }
    }
  },
  "additionalProperties": true
}
